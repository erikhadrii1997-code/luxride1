<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Luxride - Book a Ride</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Preconnect to external domains for better performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Font fallbacks to prevent rendering issues */
        body, * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .font-serif, h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=ARYOpSlIb3YT14BrKtINl6LvCNa-FxtQ-2FDr1U2KpxoAt6GHqt-eWp7nYKNAeKK1h7ZRzJrhcbwKYli&buyer-country=US&currency=USD&components=buttons&enable-funding=venmo,paylater,card" data-sdk-integration-source="developer-studio"></script>
    <style>
        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #2d2d2d;
            --accent-color: #d4af37;
            --accent-hover: #b8972e;
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            overscroll-behavior: none;
            overflow-x: hidden;
            padding-top: 70px; /* Account for fixed navbar */
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: transparent;
        }
        .btn-primary {
            background: linear-gradient(135deg, #d4af37 0%, #b8972e 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: #ffffff;
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #b8972e 0%, #d4af37 100%);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            border-radius: 12px;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%);
            box-shadow: var(--shadow-lg);
        }
        .input-field {
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #333333;
            border-radius: 12px;
            padding: 14px 16px;
        }
        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3), 0 0 20px rgba(0, 0, 0, 0.1);
            border-color: #d4af37;
        }
        .form-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1), 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .leaflet-container {
            border-radius: 12px !important;
            height: 100%;
            width: 100%;
        }
        .vehicle-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .vehicle-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #b8972e);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .vehicle-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-xl);
        }
        .vehicle-card:hover::before {
            opacity: 1;
        }
        .vehicle-card.selected {
            border: 2px solid #d4af37;
            box-shadow: var(--shadow-lg), 0 0 0 1px rgba(212, 175, 55, 0.2);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(212, 175, 55, 0.02) 100%);
        }
        .vehicle-card.selected::before {
            opacity: 1;
        }
        .vehicle-card.selected::after {
            content: '\f058';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 12px;
            right: 12px;
            color: #d4af37;
            font-size: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }
        .estimate-breakdown {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Simple Working Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: 2px solid #d4af37;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #d4af37, #b8972e);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .brand-text {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            font-family: 'Playfair Display', serif;
        }

        .desktop-nav {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: #333333;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: #d4af37;
            color: white;
        }

        .nav-item.active {
            background: #d4af37;
            color: white;
        }

        .nav-item.logout {
            background: #ef4444;
            color: white;
        }

        .nav-item.logout:hover {
            background: #dc2626;
        }

        .nav-item.home-button {
            background: linear-gradient(135deg, #d4af37, #b8972e);
            color: white;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            font-weight: 600;
            padding: 14px 20px;
            border-radius: 12px;
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-item.home-button:hover {
            background: linear-gradient(135deg, #b8972e, #d4af37);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .nav-item.home-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* Touch-friendly styles for mobile */
        @media (hover: none) and (pointer: coarse) {
            .nav-item.home-button {
                -webkit-tap-highlight-color: rgba(212, 175, 55, 0.3);
                touch-action: manipulation;
                user-select: none;
                -webkit-user-select: none;
            }
            
            .nav-item.home-button:active {
                background: linear-gradient(135deg, #b8972e, #d4af37);
                transform: scale(0.98);
            }
        }

        .mobile-toggle {
            display: none;
            flex-direction: column;
            gap: 3px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .hamburger-line {
            width: 20px;
            height: 2px;
            background: #333;
            border-radius: 1px;
        }

        .mobile-nav {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }

        .mobile-nav.active {
            right: 0;
        }

        .mobile-nav-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: #d4af37;
            color: white;
        }

        .mobile-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mobile-brand .brand-logo {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .mobile-brand .brand-text {
            color: white;
            font-size: 18px;
        }

        .mobile-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .mobile-nav-content {
            padding: 20px;
        }

        .mobile-nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 6px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #f8f9fa;
        }

        .mobile-nav-item:hover {
            background: #d4af37;
            color: white;
        }

        .mobile-nav-item.active {
            background: #d4af37;
            color: white;
        }

        .mobile-nav-item.logout {
            background: #ef4444;
            color: white;
        }

        .mobile-nav-item.logout:hover {
            background: #dc2626;
        }

        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .mobile-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        @media (max-width: 768px) {
            .desktop-nav {
                display: flex;
            }
            .mobile-toggle {
                display: none;
            }
            
            .nav-item.home-button {
                padding: 12px 16px;
                font-size: 14px;
                min-width: 100px;
                gap: 6px;
            }
            
            .navbar-container {
                padding: 0 16px;
                height: 60px;
            }
            
            .brand-text {
                font-size: 18px;
            }
            
            .brand-logo {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .navbar-container {
                padding: 0 12px;
            }
            
            .nav-item.home-button {
                padding: 10px 14px;
                font-size: 13px;
                min-width: 90px;
                gap: 4px;
            }
            
            .nav-item.home-button span {
                display: none;
            }
            
            .nav-item.home-button i {
                font-size: 16px;
            }
            
            .brand-text {
                font-size: 16px;
            }
            
            .brand-logo {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
        }

        .error-toast {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: #ffffff;
            padding: 12px;
            border-radius: 12px;
            margin: 12px 0;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #dc2626;
            animation: slideInUp 0.4s ease-out;
        }
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            min-width: 320px;
            padding: 18px 24px;
            border-radius: 12px;
            color: #ffffff;
            font-weight: 500;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1), 0 8px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.4s ease-out, opacity 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            border-left: 5px solid #d4af37;
            z-index: 1000;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .toast.info { background: linear-gradient(135deg, #d4af37, #b8972e); }
        .modal {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 24px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        .favorite-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .favorite-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        .favorite-item:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
        .favorite-item button {
            color: #d4af37;
            background: none;
            border: none;
            cursor: pointer;
        }
        .location-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
        }
        .location-suggestion {
            padding: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .location-suggestion:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 12px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s ease-in-out infinite;
        }
        .promo-code {
            display: flex;
            gap: 8px;
        }
        .promo-code input {
            flex-grow: 1;
        }
        .promo-code button {
            white-space: nowrap;
        }
        .promo-applied {
            background-color: rgba(16, 185, 129, 0.1);
            color: #059669;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 8px;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 2;
        }
        .step.active .step-circle {
            background: linear-gradient(135deg, #d4af37, #b8972e);
            color: white;
            box-shadow: var(--shadow-md);
            transform: scale(1.1);
        }
        .step.completed .step-circle {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: var(--shadow-md);
        }
        .step-line {
            height: 3px;
            background-color: #e5e7eb;
            flex-grow: 1;
            margin: 0 8px;
            margin-top: 20px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        .step.completed .step-line {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        .step span {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            transition: color 0.3s ease;
        }
        .step.active span {
            color: #d4af37;
            font-weight: 600;
        }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .map-control-btn {
            background: white;
            border: none;
            border-radius: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        .map-control-btn:hover {
            background-color: #f3f4f6;
        }
        
        /* PayPal Modal Styles */
        .paypal-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        .paypal-modal.hidden {
            display: none;
        }
        .paypal-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            max-width: 95%;
            width: 380px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1), 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            animation: slideUp 0.4s ease-out forwards;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #333333;
        }
        .paypal-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        .paypal-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }
        .paypal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .paypal-close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #374151;
        }
        .paypal-amount {
            font-size: 2.5rem;
            font-weight: 800;
            color: #d4af37;
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .paypal-description {
            margin-bottom: 24px;
        }
        .paypal-description p {
            margin: 8px 0;
            color: #4b5563;
        }
        .paypal-description .text-sm {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .paypal-button-container {
            margin: 24px 0;
            min-height: 50px;
        }
        .paypal-security {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
            padding: 12px;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 8px;
            color: #166534;
            font-size: 0.875rem;
        }
        .paypal-security i {
            color: #22c55e;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: scale(0.9) translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }
        .recent-locations {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .recent-location {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .recent-location:last-child {
            border-bottom: none;
        }
        .recent-location-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .recent-location-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: rgba(212, 175, 55, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d4af37;
        }
        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out;
        }
        .animate-slide-in-left {
            animation: slideInFromLeft 0.8s ease-out;
        }
        .animate-slide-in-right {
            animation: slideInFromRight 0.8s ease-out;
        }
        .shimmer {
            animation: shimmer 2s infinite;
        }
        @media (max-width: 640px) {
            .form-container {
                margin: 16px;
                padding: 20px;
            }
            .map-container {
                height: 250px;
            }
            .toast {
                min-width: auto;
                right: 12px;
                left: 12px;
                padding: 14px 18px;
            }
            .step-indicator {
                flex-direction: column;
                gap: 12px;
                padding: 12px;
            }
            .step {
                flex-direction: row;
                justify-content: flex-start;
                gap: 12px;
            }
            .step-circle {
                width: 32px;
                height: 32px;
                margin-bottom: 0;
            }
            .step-line {
                display: none;
            }
            .vehicle-card {
                padding: 16px;
            }
        }
    </style>
</head>
<body class="flex flex-col items-center">
    <div id="particles-js"></div>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" style="font-family: 'Playfair Display', serif;">Confirm Booking</h3>
            <div id="booking-summary" class="mb-4"></div>
            <div class="flex justify-end gap-4">
                <button id="cancel-confirm" class="px-4 py-2 text-sm rounded-full bg-gray-200 text-gray-800" aria-label="Cancel booking">Cancel</button>
                <button id="confirm-book" class="px-4 py-2 text-sm rounded-full btn-primary" aria-label="Confirm booking">Book</button>
            </div>
        </div>
    </div>

    <!-- PayPal Payment Modal -->
    <div id="paypal-modal" class="paypal-modal hidden">
        <div class="paypal-modal-content">
            <div class="paypal-modal-header">
                <h2 class="paypal-modal-title">Complete Your Payment</h2>
                <button id="paypal-close-btn" class="paypal-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="paypal-amount" id="paypal-amount">$0.00</div>
            <div class="paypal-description">
                <p>Luxride Taxi Service</p>
                <p class="text-sm text-gray-600">Secure payment powered by PayPal</p>
            </div>
            <div id="paypal-button-container" class="paypal-button-container">
                <!-- PayPal button will be rendered here -->
            </div>
            <div class="paypal-security">
                <i class="fas fa-shield-alt"></i>
                <span>Your payment is secure and encrypted</span>
            </div>
        </div>
    </div>

    <!-- Simple Home Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <!-- Logo Section -->
            <div class="navbar-brand">
                <div class="brand-logo">
                    <i class="fas fa-car"></i>
                </div>
                <span class="brand-text">Luxride</span>
            </div>

            <!-- Home Button -->
            <div class="navbar-nav desktop-nav">
                <a href="/" class="nav-item home-button">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
            </div>
        </div>
    </nav>

    <section class="py-16 w-full flex justify-center">
        <div class="form-container p-8 max-w-5xl w-full mx-6">
            <div class="text-center mb-12 animate-fade-in-up">
                <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 bg-clip-text text-transparent" style="font-family: 'Playfair Display', serif;">Book Your Ride</h2>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">Choose your perfect vehicle and get on the road in minutes. Real-time estimates and smart suggestions.</p>
            </div>
            
            <!-- Step Indicator -->
            <div class="step-indicator animate-slide-in-left">
                <div class="step active" id="step-1">
                    <div class="step-circle">1</div>
                    <span class="text-xs">Location</span>
                </div>
                <div class="step-line"></div>
                <div class="step" id="step-2">
                    <div class="step-circle">2</div>
                    <span class="text-xs">Vehicle</span>
                </div>
                <div class="step-line"></div>
                <div class="step-line"></div>
                <div class="step" id="step-4">
                    <div class="step-circle">4</div>
                    <span class="text-xs">Confirm</span>
                </div>
            </div>
            
            <form id="booking-form" class="space-y-6">
                <!-- Step 1: Location -->
                <div id="step-1-content" class="step-content">
                    <div class="relative">
                        <input type="text" id="pickup" placeholder="Pickup Location (e.g., 123 Main St, City)" class="w-full pl-12 input-field text-sm" required>
                        <i class="fas fa-map-marker-alt absolute top-1/2 left-4 transform -translate-y-1/2 text-[#d4af37] text-lg"></i>
                        <button type="button" id="geolocate-btn" class="absolute top-1/2 right-4 transform -translate-y-1/2 text-[#d4af37]">
                            <i class="fas fa-location-crosshairs"></i>
                        </button>
                        <div id="pickup-suggestions" class="location-suggestions hidden"></div>
                    </div>
                    <div class="relative mt-4">
                        <input type="text" id="dropoff" placeholder="Dropoff Location (e.g., Airport)" class="w-full pl-12 input-field text-sm" required>
                        <i class="fas fa-location-arrow absolute top-1/2 left-4 transform -translate-y-1/2 text-[#d4af37] text-lg"></i>
                        <div id="dropoff-suggestions" class="location-suggestions hidden"></div>
                    </div>
                    <div class="relative mt-4">
                        <input type="datetime-local" id="datetime" class="w-full pl-12 input-field text-sm" required>
                        <i class="fas fa-calendar-alt absolute top-1/2 left-4 transform -translate-y-1/2 text-[#d4af37] text-lg"></i>
                    </div>
                    <div class="flex justify-end mt-4">
                        <button type="button" id="next-to-vehicles" class="px-4 py-2 btn-primary text-sm">Next</button>
                    </div>
                </div>
                
                <!-- Step 2: Vehicle Selection -->
                <div id="step-2-content" class="step-content hidden">
                    <h3 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">Select Vehicle</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="vehicle-card text-center" data-type="standard">
                            <img src="https://images.pexels.com/photos/1719648/pexels-photo-1719648.jpeg" alt="Standard Sedan" class="mx-auto mb-2 rounded-lg object-cover h-32 w-full">
                            <p class="font-semibold">Standard Sedan</p>
                            <p class="text-sm">$2.50/km • 4 seats</p>
                        </div>
                        <div class="vehicle-card text-center" data-type="premium">
                            <img src="https://images.pexels.com/photos/3764988/pexels-photo-3764988.jpeg" alt="Premium SUV" class="mx-auto mb-2 rounded-lg object-cover h-32 w-full">
                            <p class="font-semibold">Premium SUV</p>
                            <p class="text-sm">$3.50/km • 6 seats</p>
                        </div>
                        <div class="vehicle-card text-center" data-type="luxury">
                            <img src="https://alphazug.com/wp-content/uploads/2020/11/800px-Rolls-Royce_Phantom_VIII_Genf_2019_1Y7A5148.jpg" alt="Luxury Van" class="mx-auto mb-2 rounded-lg object-cover h-32 w-full">
                            <p class="font-semibold">Luxury Van</p>
                            <p class="text-sm">$4.00/km • 8 seats</p>
                        </div>
                        <div class="vehicle-card text-center" data-type="xl">
                            <img src="https://media.istockphoto.com/id/1348551471/photo/night-photo-of-a-cadillac-escalade-luxury-suv-limo-used-for-uber-and-lyft.jpg?s=612x612&w=0&k=20&c=o6z49qXSxzjUm6JR8ml2QQNxs1E1oBgJOktZwYAWkZo=" alt="XL Executive" class="mx-auto mb-2 rounded-lg object-cover h-32 w-full">
                            <p class="font-semibold">XL Executive</p>
                            <p class="text-sm">$5.00/km • 10 seats</p>
                        </div>
                    </div>
                    <div class="flex justify-between mt-4">
                        <button type="button" id="back-to-location" class="px-4 py-2 btn-secondary text-sm">Back</button>
                        <button type="button" id="next-to-confirm" class="px-4 py-2 btn-primary text-sm">Next</button>
                    </div>
                </div>
                
                
                <!-- Step 4: Confirmation -->
                <div id="step-4-content" class="step-content hidden">
                    <h3 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">Confirm Your Booking</h3>
                    <div id="booking-details" class="bg-white rounded-lg p-4 mb-4"></div>
                    <div id="map" class="map-container">
                        <div class="loading-overlay hidden" id="map-loading">
                            <div class="spinner"></div>
                        </div>
                        <div class="map-controls">
                            <button id="zoom-in" class="map-control-btn">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button id="zoom-out" class="map-control-btn">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button id="fullscreen" class="map-control-btn">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div id="estimate-breakdown" class="estimate-breakdown">
                        <h3 class="text-lg font-semibold mb-4">Fare Estimate</h3>
                        <div class="flex justify-between mb-2">
                            <span>Base Fare:</span>
                            <span id="base-fare">$0.00</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Distance (approx):</span>
                            <span id="distance">0 km</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Time (approx):</span>
                            <span id="time">0 min</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Vehicle Type:</span>
                            <span id="vehicle-type">Not Selected</span>
                        </div>
                        <div class="flex justify-between mb-2 hidden" id="promo-discount-row">
                            <span>Promo Discount:</span>
                            <span id="promo-discount">-$0.00</span>
                        </div>
                        <div class="flex justify-between font-bold">
                            <span>Total:</span>
                            <span id="total-cost">$0.00</span>
                        </div>
                    </div>
                    <div class="flex justify-between mt-4">
                        <button type="button" id="back-to-vehicles" class="px-4 py-2 btn-secondary text-sm">Back</button>
                        <button type="submit" class="px-4 py-2 btn-primary text-sm">Book Now</button>
                    </div>
                </div>
            </form>
            <div id="form-message" class="mt-4"></div>
            
            <!-- Recent Locations -->
            <div class="recent-locations">
                <h3 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">Recent Locations</h3>
                <div id="recent-locations-list" class="space-y-2"></div>
            </div>
            
            <!-- Favorite Locations -->
            <div class="favorite-list">
                <h3 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">Favorite Locations</h3>
                <ul id="favorite-locations" class="space-y-2"></ul>
            </div>
            
            <div class="mt-8 text-center">
                <h3 class="text-xl font-semibold mb-4" style="font-family: 'Playfair Display', serif;">Smart Features</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="p-4 bg-white rounded-lg shadow-md">
                        <i class="fas fa-map-marked-alt text-3xl text-[#d4af37] mb-2"></i>
                        <p>Real-Time Tracking</p>
                    </div>
                    <div class="p-4 bg-white rounded-lg shadow-md">
                        <i class="fas fa-lightbulb text-3xl text-[#d4af37] mb-2"></i>
                        <p>Personalized Suggestions</p>
                    </div>
                    <div class="p-4 bg-white rounded-lg shadow-md">
                        <i class="fas fa-shield-alt text-3xl text-[#d4af37] mb-2"></i>
                        <p>Secure Service</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="py-8 w-full">
        <div class="container mx-auto px-4 max-w-md">
            <div class="grid grid-cols-1 gap-6 text-center">
                <div>
                    <h4 class="text-lg font-bold mb-3" style="font-family: 'Playfair Display', serif;">Luxride</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/" class="hover:text-[#d4af37]">About us</a></li>
                        <li><a href="#" class="hover:text-[#d4af37]">Careers</a></li>
                        <li><a href="#" class="hover:text-[#d4af37]">Newsroom</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3" style="font-family: 'Playfair Display', serif;">Support</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/" class="hover:text-[#d4af37]">Help Center</a></li>
                        <li><a href="#" class="hover:text-[#d4af37]">Contact us</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3" style="font-family: 'Playfair Display', serif;">Follow us</h4>
                    <div class="flex space-x-4 justify-center">
                        <a href="#" class="hover:text-[#d4af37]"><i class="fab fa-facebook-f text-lg"></i></a>
                        <a href="#" class="hover:text-[#d4af37]"><i class="fab fa-twitter text-lg"></i></a>
                        <a href="#" class="hover:text-[#d4af37]"><i class="fab fa-instagram text-lg"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-6 text-center text-sm text-gray-600">
                <p>&copy; 2025 Luxride Technologies Inc. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS('particles-js', {
            particles: {
                number: { value: 50, density: { enable: true, value_area: 1000 } },
                color: { value: ['#d4af37', '#3b82f6', '#ffffff', '#b8972e'] },
                shape: { type: 'circle', stroke: { width: 2, color: '#d4af37' } },
                opacity: { value: 0.6, random: true, anim: { enable: true, speed: 1.5, opacity_min: 0.1 } },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: '#d4af37', opacity: 0.4, width: 1 },
                move: { enable: true, speed: 2, direction: 'none', random: true }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' } },
                modes: { repulse: { distance: 100 }, push: { particles_nb: 4 } }
            },
            retina_detect: true
        });

        class Toast {
            static show(message, type = 'info', duration = 4000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                    <i class="fas fa-times close" onclick="this.parentElement.remove()"></i>
                `;
                container.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
            static success(message) { this.show(message, 'success'); }
            static error(message) { this.show(message, 'error'); }
            static warning(message) { this.show(message, 'warning'); }
            static info(message) { this.show(message, 'info'); }
        }

        // Global variables
        let currentStep = 1;
        let selectedVehicle = null;
        let bookingData = null;
        let map = null;
        let pickupMarker = null;
        let dropoffMarker = null;
        let routeControl = null;
        let promoDiscount = 0;

        // DOM elements
        const form = document.getElementById('booking-form');
        const messageContainer = document.getElementById('form-message');
        const estimateBreakdown = document.getElementById('estimate-breakdown');
        const vehicleCards = document.querySelectorAll('.vehicle-card');
        const pickupInput = document.getElementById('pickup');
        const dropoffInput = document.getElementById('dropoff');
        const geolocateBtn = document.getElementById('geolocate-btn');
        const favoriteList = document.querySelector('.favorite-list');
        const favoriteLocations = document.getElementById('favorite-locations');
        const confirmationModal = document.getElementById('confirmation-modal');
        const cancelConfirm = document.getElementById('cancel-confirm');
        const confirmBook = document.getElementById('confirm-book');
        const bookingSummary = document.getElementById('booking-summary');
        const bookingDetails = document.getElementById('booking-details');
        const promoCodeInput = document.getElementById('promo-code');
        const applyPromoBtn = document.getElementById('apply-promo');
        const promoResult = document.getElementById('promo-result');
        const promoDiscountRow = document.getElementById('promo-discount-row');
        const promoDiscountAmount = document.getElementById('promo-discount');
        const mapLoading = document.getElementById('map-loading');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const fullscreenBtn = document.getElementById('fullscreen');
        const recentLocationsList = document.getElementById('recent-locations-list');

        // Step navigation buttons
        const nextToVehiclesBtn = document.getElementById('next-to-vehicles');
        const backToLocationBtn = document.getElementById('back-to-location');
        const backToVehiclesBtn = document.getElementById('back-to-vehicles');
        const nextToConfirmBtn = document.getElementById('next-to-confirm');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadRecentLocations();
            loadFavoriteLocations();
            initializeMap();
            setupEventListeners();
            initNavbar();
            
            // Set default datetime to current time + 1 hour
            const now = new Date();
            now.setHours(now.getHours() + 1);
            document.getElementById('datetime').value = now.toISOString().slice(0, 16);
        });

        // Initialize map
        function initializeMap() {
            // Initially hide the map container
            document.getElementById('map').style.display = 'none';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Vehicle selection
            vehicleCards.forEach(card => {
                card.addEventListener('click', () => {
                    vehicleCards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedVehicle = card.dataset.type;
                });
            });

            // Step navigation
            nextToVehiclesBtn.addEventListener('click', () => validateAndGoToStep(2));
            backToLocationBtn.addEventListener('click', () => goToStep(1));
            backToVehiclesBtn.addEventListener('click', () => goToStep(2));
            nextToConfirmBtn.addEventListener('click', () => validateAndGoToStep(4));

            // Form submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (currentStep === 4) {
                    confirmBooking();
                }
            });

            // Geolocation
            geolocateBtn.addEventListener('click', getCurrentLocation);

            // Promo code
            applyPromoBtn.addEventListener('click', applyPromoCode);

            // Map controls
            zoomInBtn.addEventListener('click', () => {
                if (map) map.zoomIn();
            });
            zoomOutBtn.addEventListener('click', () => {
                if (map) map.zoomOut();
            });
            fullscreenBtn.addEventListener('click', () => {
                const mapContainer = document.getElementById('map');
                if (!document.fullscreenElement) {
                    mapContainer.requestFullscreen().catch(err => {
                        Toast.error(`Error attempting to enable fullscreen: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            });

            // Location suggestions
            setupLocationAutocomplete('pickup', 'pickup-suggestions');
            setupLocationAutocomplete('dropoff', 'dropoff-suggestions');

            // Modal
            cancelConfirm.addEventListener('click', () => confirmationModal.classList.add('hidden'));
            confirmBook.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
                processBooking();
            });

        }

        // Setup location autocomplete
        function setupLocationAutocomplete(inputId, suggestionsId) {
            const input = document.getElementById(inputId);
            const suggestions = document.getElementById(suggestionsId);
            
            input.addEventListener('input', () => {
                const query = input.value.trim();
                if (query.length < 2) {
                    suggestions.classList.add('hidden');
                    return;
                }
                
                // Simulate API call with mock data
                setTimeout(() => {
                    const mockSuggestions = generateMockSuggestions(query);
                    renderSuggestions(mockSuggestions, suggestions, input);
                }, 300);
            });
            
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.classList.add('hidden');
                }
            });
        }

        // Generate mock location suggestions
        function generateMockSuggestions(query) {
            const locations = [
                '123 Main Street, New York, NY',
                '456 Park Avenue, New York, NY',
                '789 Broadway, New York, NY',
                'JFK Airport, New York, NY',
                'LaGuardia Airport, New York, NY',
                'Times Square, New York, NY',
                'Central Park, New York, NY',
                'Empire State Building, New York, NY',
                'Brooklyn Bridge, New York, NY',
                'Statue of Liberty, New York, NY'
            ];
            
            return locations.filter(loc => 
                loc.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 5);
        }

        // Render location suggestions
        function renderSuggestions(suggestions, container, input) {
            container.innerHTML = '';
            
            if (suggestions.length === 0) {
                container.innerHTML = '<div class="location-suggestion">No results found</div>';
            } else {
                suggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.className = 'location-suggestion';
                    div.textContent = suggestion;
                    div.addEventListener('click', () => {
                        input.value = suggestion;
                        container.classList.add('hidden');
                    });
                    container.appendChild(div);
                });
            }
            
            container.classList.remove('hidden');
        }

        // Step navigation
        function goToStep(step) {
            // Hide all step contents
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show current step content
            document.getElementById(`step-${step}-content`).classList.remove('hidden');
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                if (index + 1 < step) {
                    stepEl.classList.add('completed');
                    stepEl.classList.remove('active');
                } else if (index + 1 === step) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('completed');
                } else {
                    stepEl.classList.remove('active', 'completed');
                }
            });
            
            // Update step lines
            document.querySelectorAll('.step-line').forEach((line, index) => {
                if (index + 1 < step) {
                    line.classList.add('completed');
                } else {
                    line.classList.remove('completed');
                }
            });
            
            currentStep = step;
            
            // Initialize map when reaching step 4
            if (step === 4 && !map) {
                initializeMapForStep4();
            }
        }

        // Validate and go to step
        function validateAndGoToStep(step) {
            let isValid = true;
            
            if (step === 2) {
                // Validate location inputs
                if (!pickupInput.value.trim()) {
                    Toast.error('Please enter a pickup location');
                    isValid = false;
                } else if (!dropoffInput.value.trim()) {
                    Toast.error('Please enter a dropoff location');
                    isValid = false;
                } else if (!document.getElementById('datetime').value) {
                    Toast.error('Please select a date and time');
                    isValid = false;
                }
            } else if (step === 3) {
                // Validate vehicle selection
                if (!selectedVehicle) {
                    Toast.error('Please select a vehicle');
                    isValid = false;
                }
            } else if (step === 4) {
                // Validate confirmation step
                isValid = true;
            }
            
            if (isValid) {
                goToStep(step);
            }
        }

        // Initialize map for step 4
        function initializeMapForStep4() {
            document.getElementById('map').style.display = 'block';
            mapLoading.classList.remove('hidden');
            
            // Initialize map
            map = L.map('map').setView([40.7128, -74.0060], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            
            // Simulate getting coordinates for pickup and dropoff
            setTimeout(() => {
                const pickupCoords = [40.7128, -74.0060];
                const dropoffCoords = [40.6413, -73.7781];
                
                // Add markers
                pickupMarker = L.marker(pickupCoords).addTo(map)
                    .bindPopup('Pickup Location')
                    .openPopup();
                
                dropoffMarker = L.marker(dropoffCoords).addTo(map)
                    .bindPopup('Dropoff Location');
                
                // Add route
                routeControl = L.Routing.control({
                    waypoints: [
                        L.latLng(pickupCoords[0], pickupCoords[1]),
                        L.latLng(dropoffCoords[0], dropoffCoords[1])
                    ],
                    routeWhileDragging: false,
                    addWaypoints: false,
                    createMarker: () => null, // Don't create additional markers
                    lineOptions: {
                        styles: [{ color: '#d4af37', weight: 4, opacity: 0.7 }]
                    }
                }).on('routesfound', (e) => {
                    const routes = e.routes;
                    const summary = routes[0].summary;
                    
                    // Update estimate breakdown with real data
                    document.getElementById('distance').textContent = `${(summary.totalDistance / 1000).toFixed(1)} km`;
                    document.getElementById('time').textContent = `${Math.round(summary.totalTime / 60)} min`;
                    
                    // Calculate fare
                    calculateFare();
                }).addTo(map);
                
                // Fit map to show both markers
                map.fitBounds([pickupCoords, dropoffCoords]);
                
                mapLoading.classList.add('hidden');
            }, 1000);
        }

        // Calculate fare
        function calculateFare() {
            const distance = parseFloat(document.getElementById('distance').textContent);
            const time = parseFloat(document.getElementById('time').textContent);
            const rates = { standard: 2.5, premium: 3.5, luxury: 4.0, xl: 5.0 };
            const baseFare = 10.0;
            const vehicleRate = rates[selectedVehicle] || 2.5;
            const distanceCost = distance * vehicleRate;
            const timeCost = time * 0.5; // $0.5 per minute
            let total = baseFare + distanceCost + timeCost;
            
            // Apply promo discount if applicable
            if (promoDiscount > 0) {
                const discountAmount = total * (promoDiscount / 100);
                total -= discountAmount;
                promoDiscountAmount.textContent = `-$${discountAmount.toFixed(2)}`;
                promoDiscountRow.classList.remove('hidden');
            } else {
                promoDiscountRow.classList.add('hidden');
            }
            
            // Update UI
            document.getElementById('base-fare').textContent = `$${baseFare.toFixed(2)}`;
            document.getElementById('total-cost').textContent = `$${total.toFixed(2)}`;
            
            // Update vehicle type display
            const vehicleNames = {
                standard: 'Standard Sedan',
                premium: 'Premium SUV',
                luxury: 'Luxury Van',
                xl: 'XL Executive'
            };
            document.getElementById('vehicle-type').textContent = vehicleNames[selectedVehicle];
            
            // Update booking details
            updateBookingDetails(total);
        }

        // Update booking details
        function updateBookingDetails(total) {
            const pickup = pickupInput.value;
            const dropoff = dropoffInput.value;
            const datetime = document.getElementById('datetime').value;
            const paymentMethod = 'Cash';
            
            const vehicleNames = {
                standard: 'Standard Sedan',
                premium: 'Premium SUV',
                luxury: 'Luxury Van',
                xl: 'XL Executive'
            };
            
            const formattedDate = new Date(datetime).toLocaleString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            bookingDetails.innerHTML = `
                <div class="flex justify-between mb-2">
                    <span class="font-semibold">Pickup:</span>
                    <span>${pickup}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="font-semibold">Dropoff:</span>
                    <span>${dropoff}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="font-semibold">Date & Time:</span>
                    <span>${formattedDate}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="font-semibold">Vehicle:</span>
                    <span>${vehicleNames[selectedVehicle]}</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="font-semibold">Payment:</span>
                    <span>${paymentMethod}</span>
                </div>
                <div class="flex justify-between font-bold">
                    <span>Total:</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;
        }

        // Apply promo code
        function applyPromoCode() {
            const code = promoCodeInput.value.trim();
            
            if (!code) {
                Toast.error('Please enter a promo code');
                return;
            }
            
            // Simulate API call to validate promo code
            setTimeout(() => {
                // Mock promo codes
                const promoCodes = {
                    'LUXRIDE10': 10,
                    'SAVE20': 20,
                    'FIRST15': 15
                };
                
                if (promoCodes[code]) {
                    promoDiscount = promoCodes[code];
                    promoResult.innerHTML = `<div class="promo-applied">Promo code applied! You saved ${promoDiscount}%</div>`;
                    promoResult.classList.remove('hidden');
                    Toast.success(`Promo code applied! You saved ${promoDiscount}%`);
                    
                    // Recalculate fare if we're on the confirmation step
                    if (currentStep === 4) {
                        calculateFare();
                    }
                } else {
                    promoResult.innerHTML = `<div class="error-toast">Invalid promo code</div>`;
                    promoResult.classList.remove('hidden');
                    Toast.error('Invalid promo code');
                }
            }, 500);
        }

        // Confirm booking
        function confirmBooking() {
            // Get booking details
            const pickup = pickupInput.value;
            const dropoff = dropoffInput.value;
            const datetime = document.getElementById('datetime').value;
            const total = document.getElementById('total-cost').textContent;
            
            console.log('=== confirmBooking() CALLED ===');
            console.log('Pickup:', pickup);
            console.log('Dropoff:', dropoff);
            console.log('Datetime:', datetime);
            console.log('Total:', total);
            
            // For testing, let's also process the booking directly
            // This ensures bookings are created even if PayPal flow fails
            processBooking();
            
            // Show PayPal payment modal
            showPayPalModal(total);
        }

        // Process booking
        function processBooking() {
            console.log('=== FIRST processBooking() CALLED ===');
            const pickup = pickupInput.value;
            const dropoff = dropoffInput.value;
            const datetime = document.getElementById('datetime').value;
            const payment = 'cash';
            const total = document.getElementById('total-cost').textContent;
            
            // Create booking data
            bookingData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                pickup,
                destination: dropoff,
                date: datetime,
                vehicleInfo: {
                    name: selectedVehicle,
                    fullName: document.getElementById('vehicle-type').textContent,
                    price: total,
                    capacity: selectedVehicle === 'standard' ? 4 : selectedVehicle === 'premium' ? 6 : selectedVehicle === 'luxury' ? 8 : 10,
                    time: document.getElementById('time').textContent
                },
                status: 'requested',
                archived: false,
                paymentId: payment
            };
            
            // Save to localStorage
            let rides = JSON.parse(localStorage.getItem('rideNotifications') || '[]');
            rides.push(bookingData);
            localStorage.setItem('rideNotifications', JSON.stringify(rides));

            // ALSO save to bookedRides for user inbox
            let bookedRides = JSON.parse(localStorage.getItem('bookedRides') || '[]');
            bookedRides.unshift(bookingData);
            localStorage.setItem('bookedRides', JSON.stringify(bookedRides));
            
            console.log('Book.html (first processBooking): Saved to bookedRides:', bookingData);
            console.log('Book.html (first processBooking): All bookedRides:', bookedRides);
            
            let trips = JSON.parse(localStorage.getItem('trips') || '[]');
            trips.push({
                id: bookingData.id,
                route: `${bookingData.pickup} to ${bookingData.destination}`,
                date: bookingData.date.split('T')[0],
                type: bookingData.vehicleInfo.fullName,
                price: parseFloat(bookingData.vehicleInfo.price.replace('$', '')),
                status: 'Upcoming'
            });
            localStorage.setItem('trips', JSON.stringify(trips));

            // ALSO save to bookings array for driver inbox
            let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const bookingForDriver = {
                id: bookingData.id,
                pickup: bookingData.pickup,
                destination: bookingData.destination,
                date: new Date(bookingData.date).toLocaleDateString(),
                time: new Date(bookingData.date).toLocaleTimeString(),
                type: bookingData.vehicleInfo.fullName,
                price: parseFloat(bookingData.vehicleInfo.price.replace('$', '')),
                status: 'requested',
                timestamp: bookingData.timestamp
            };
            bookings.unshift(bookingForDriver);
            localStorage.setItem('bookings', JSON.stringify(bookings));
            
            console.log('Book.html (first processBooking): Saved booking to bookings array:', bookingForDriver);
            console.log('Book.html (first processBooking): All bookings:', bookings);
            
            // Add to recent locations
            let recentLocations = JSON.parse(localStorage.getItem('recentLocations') || '[]');
            if (!recentLocations.includes(pickup)) {
                recentLocations.unshift(pickup);
                if (recentLocations.length > 5) recentLocations.pop(); // Keep only 5 recent locations
                localStorage.setItem('recentLocations', JSON.stringify(recentLocations));
            }
            
            if (!recentLocations.includes(dropoff)) {
                recentLocations.unshift(dropoff);
                if (recentLocations.length > 5) recentLocations.pop(); // Keep only 5 recent locations
                localStorage.setItem('recentLocations', JSON.stringify(recentLocations));
            }
            
            // Add to favorites if not already there
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (!favorites.includes(pickup)) favorites.push(pickup);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // Create driver notification for this booking
            createDriverNotificationFromBooking(bookingData);

            // Trigger storage events for real-time updates
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'bookedRides',
                newValue: JSON.stringify(bookedRides)
            }));
            
            // Show success message
            Toast.success('Ride booked successfully! Check your Inbox.');
            
            // Reset form
            form.reset();
            estimateBreakdown.classList.add('hidden');
            vehicleCards.forEach(c => c.classList.remove('selected'));
            selectedVehicle = null;
            promoDiscount = 0;
            promoResult.classList.add('hidden');
            
            // Go back to step 1
            goToStep(1);
            
            // Reload recent locations
            loadRecentLocations();
        }

        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                Toast.info('Getting your location...');
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const { latitude, longitude } = position.coords;
                        pickupInput.value = `Current Location (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
                        Toast.success('Location fetched!');
                        
                        // If map is initialized, update it
                        if (map) {
                            map.setView([latitude, longitude], 15);
                            if (pickupMarker) {
                                pickupMarker.setLatLng([latitude, longitude]);
                            } else {
                                pickupMarker = L.marker([latitude, longitude]).addTo(map)
                                    .bindPopup('Your Location')
                                    .openPopup();
                            }
                        }
                    },
                    error => {
                        Toast.error('Unable to fetch location: ' + error.message);
                    },
                    { enableHighAccuracy: true }
                );
            } else {
                Toast.error('Geolocation not supported by your browser.');
            }
        }

        // Load recent locations
        function loadRecentLocations() {
            const recentLocations = JSON.parse(localStorage.getItem('recentLocations') || '[]');
            recentLocationsList.innerHTML = '';
            
            if (recentLocations.length === 0) {
                recentLocationsList.innerHTML = '<p class="text-gray-500">No recent locations</p>';
                return;
            }
            
            recentLocations.forEach(location => {
                const div = document.createElement('div');
                div.className = 'recent-location';
                div.innerHTML = `
                    <div class="recent-location-info">
                        <div class="recent-location-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <span>${location}</span>
                    </div>
                    <button class="text-[#d4af37]" onclick="selectLocation('${location}')">
                        <i class="fas fa-plus-circle"></i>
                    </button>
                `;
                recentLocationsList.appendChild(div);
            });
        }

        // Load favorite locations
        function loadFavoriteLocations() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            favoriteLocations.innerHTML = '';
            
            if (favorites.length === 0) {
                favoriteList.classList.add('hidden');
                return;
            }
            
            favoriteList.classList.remove('hidden');
            favorites.forEach(location => {
                const li = document.createElement('li');
                li.className = 'favorite-item';
                li.innerHTML = `
                    <span>${location}</span>
                    <button class="text-[#d4af37]" onclick="selectLocation('${location}')">
                        <i class="fas fa-plus-circle"></i>
                    </button>
                `;
                favoriteLocations.appendChild(li);
            });
        }

        // Select location from favorites or recent
        function selectLocation(location) {
            pickupInput.value = location;
            Toast.info(`Selected: ${location}`);
        }

        // Simple Home Button Navigation
        function initNavbar() {
            // No complex navbar functionality needed - just a simple home button
            console.log('Simple home navigation initialized in book.html');
        }

        // ===== PAYPAL INTEGRATION =====
        const paypalModal = document.getElementById('paypal-modal');
        const paypalCloseBtn = document.getElementById('paypal-close-btn');
        const paypalAmount = document.getElementById('paypal-amount');
        const paypalButtonContainer = document.getElementById('paypal-button-container');

        function showPayPalModal(amount) {
            paypalAmount.textContent = amount;
            paypalModal.classList.remove('hidden');
            renderPayPalButton(amount);
        }

        function hidePayPalModal() {
            paypalModal.classList.add('hidden');
            paypalButtonContainer.innerHTML = '';
        }

        function renderPayPalButton(amount) {
            // Clear previous button
            paypalButtonContainer.innerHTML = '';
            
            // Extract numeric value from amount string (e.g., "$26.00" -> "26.00")
            const numericAmount = amount.replace('$', '');
            
            paypal.Buttons({
                style: {
                    shape: 'rect',
                    layout: 'vertical',
                    color: 'gold',
                    label: 'paypal',
                },
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: numericAmount,
                                currency_code: 'USD'
                            },
                            description: 'Luxride Taxi Service'
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // Payment successful
                        hidePayPalModal();
                        Toast.success('Payment successful! Your ride has been booked.');
                        
                        // Process the booking
                        processBookingAfterPayment();
                        
                        // Add to inbox
                        addToInbox();
                    });
                },
                onError: function(err) {
                    Toast.error('Payment failed. Please try again.');
                    console.error('PayPal error:', err);
                },
                onCancel: function(data) {
                    Toast.info('Payment cancelled.');
                }
            }).render('#paypal-button-container');
        }

        // Close PayPal modal
        paypalCloseBtn.addEventListener('click', hidePayPalModal);
        paypalModal.addEventListener('click', (e) => {
            if (e.target === paypalModal) {
                hidePayPalModal();
            }
        });

        // Process booking after payment
        function processBookingAfterPayment() {
            console.log('=== SECOND processBookingAfterPayment() CALLED ===');
            const pickup = pickupInput.value;
            const dropoff = dropoffInput.value;
            const datetime = document.getElementById('datetime').value;
            const total = document.getElementById('total-cost').textContent;
            
            const vehicleNames = {
                standard: 'Standard Sedan',
                premium: 'Premium SUV',
                luxury: 'Luxury Van',
                xl: 'XL Executive'
            };
            
            const formattedDate = new Date(datetime).toLocaleString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Create booking object
            const booking = {
                id: 'trip-' + Date.now(),
                pickup: pickup,
                destination: dropoff,
                date: formattedDate,
                time: new Date(datetime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                duration: '36 min', // Mock duration
                distance: '11.2 miles', // Mock distance
                type: vehicleNames[selectedVehicle] || 'Standard Sedan',
                driver: 'John Smith', // Mock driver
                price: parseFloat(total.replace('$', '')),
                status: 'requested', // Changed to 'requested' to make it available for drivers
                rating: 4.8,
                timestamp: new Date().toISOString(),
                vehicleType: selectedVehicle,
                estimatedDuration: Math.round(Math.random() * 30 + 15), // 15-45 minutes
                estimatedDistance: Math.round((Math.random() * 15 + 5) * 10) / 10 // 5-20 miles
            };
            
            // Store booking in localStorage
            let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            bookings.unshift(booking);
            localStorage.setItem('bookings', JSON.stringify(bookings));

            // ALSO save to bookedRides for user inbox
            let bookedRides = JSON.parse(localStorage.getItem('bookedRides') || '[]');
            const bookedRideData = {
                id: booking.id,
                timestamp: booking.timestamp,
                status: booking.status,
                pickup: booking.pickup,
                destination: booking.destination,
                datetime: new Date(booking.date + ' ' + booking.time).toISOString(),
                vehicleInfo: {
                    name: booking.type,
                    fullName: booking.type,
                    price: '$' + booking.price.toFixed(2),
                    capacity: booking.type === 'Standard Sedan' ? 4 : booking.type === 'Premium SUV' ? 6 : booking.type === 'Luxury Van' ? 8 : 10,
                    time: booking.time
                },
                fare: booking.price.toFixed(2),
                archived: false
            };
            bookedRides.unshift(bookedRideData);
            localStorage.setItem('bookedRides', JSON.stringify(bookedRides));
            
            console.log('Book.html (second processBooking): Saved to bookedRides:', bookedRideData);
            console.log('Book.html (second processBooking): All bookedRides:', bookedRides);
            console.log('Book.html (second processBooking): Saved booking to bookings array:', booking);
            console.log('Book.html (second processBooking): All bookings:', bookings);
            
            // Create driver notification
            createDriverNotification(booking);

            // Trigger storage events for real-time updates
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'bookedRides',
                newValue: JSON.stringify(bookedRides)
            }));
            
            // Show success message
            Toast.success('Ride booked successfully! Your request has been sent to available drivers.');
            
            // Reset form
            resetForm();
        }

        // Create driver notification for new ride request
        function createDriverNotification(booking) {
            console.log('Book.html: Creating notification for booking:', booking);
            
            // Simply trigger storage event for bookings array
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'bookings',
                newValue: localStorage.getItem('bookings')
            }));

            console.log('Book.html: Storage event triggered for bookings');
        }

        // Create driver notification from booking data (for first processBooking function)
        function createDriverNotificationFromBooking(bookingData) {
            console.log('Book.html: Creating notification from booking data:', bookingData);
            
            // Simply trigger storage event for bookings array
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'bookings',
                newValue: localStorage.getItem('bookings')
            }));

            console.log('Book.html: Storage event triggered for bookings from booking data');
        }





        // Add booking to inbox
        function addToInbox() {
            const pickup = pickupInput.value;
            const dropoff = dropoffInput.value;
            const datetime = document.getElementById('datetime').value;
            const total = document.getElementById('total-cost').textContent;
            
            const vehicleNames = {
                standard: 'Standard Sedan',
                premium: 'Premium SUV',
                luxury: 'Luxury Van',
                xl: 'XL Executive'
            };
            
            const formattedDate = new Date(datetime).toLocaleString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Create inbox notification
            const notification = {
                id: 'notification-' + Date.now(),
                type: 'booking_confirmed',
                title: 'Ride Booked Successfully!',
                message: `Your ride from ${pickup} to ${dropoff} has been confirmed for ${formattedDate}.`,
                timestamp: new Date().toISOString(),
                read: false,
                booking: {
                    pickup: pickup,
                    destination: dropoff,
                    date: formattedDate,
                    vehicle: vehicleNames[selectedVehicle] || 'Standard Sedan',
                    total: total
                }
            };
            
            // Store in inbox
            let inbox = JSON.parse(localStorage.getItem('inbox') || '[]');
            inbox.unshift(notification);
            localStorage.setItem('inbox', JSON.stringify(inbox));
        }

        // Reset form after successful booking
        function resetForm() {
            pickupInput.value = '';
            dropoffInput.value = '';
            document.getElementById('datetime').value = '';
            selectedVehicle = null;
            currentStep = 1;
            goToStep(1);
            
            // Reset vehicle selection
            vehicleCards.forEach(card => {
                card.classList.remove('selected');
            });
            
            // Reset estimate
            document.getElementById('total-cost').textContent = '$0.00';
        }
    </script>
</body>
</html>